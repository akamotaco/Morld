# entities/characters/ella.py - 엘라 캐릭터 정의

from entities.characters.base import BaseCharacter


class Ella(BaseCharacter):
    """엘라 - 저택 관리자, 위엄있는 리더"""

    # === 기본 정보 ===
    ID = 5
    NAME = "엘라"
    TYPE = "female"
    START_LOCATION = (0, 11)  # 엘라의 방

    # === 태그 (스탯) ===
    TAGS = {
        # 외모
        "외모:흑발": 1,
        "외모:올림머리": 1,
        "외모:보라색눈": 1,
        # 성격
        "성격:냉정함": 1,
        "성격:리더십": 1,
        # 관계 (플레이어와)
        "애정": 0,
        "성욕": 0,
        "질투": 0,
        # 상태
        "피로": 0,
        "기분": 5,
    }

    # === 외관 묘사 ===
    APPEARANCE = {
        "default": "단정하게 올린 흑발의 위엄있는 여성. 보라색 눈이 냉정해 보인다.",
        "기쁨": "표정 변화는 적지만, 눈빛이 부드러워졌다.",
        "슬픔": "평소보다 더 차가워 보인다. 무언가 생각에 잠겨 있다.",
        "분노": "눈빛이 날카롭다. 함부로 다가가기 어렵다.",
        "식사": "우아하게 식사 중이다.",
        "수면": "단정한 자세로 잠들어 있다.",
        "관리": "서류를 검토하며 무언가 기록하고 있다.",
        "조회": "모두를 둘러보며 하루 일과를 지시하고 있다."
    }

    # === 행동 목록 ===
    ACTIONS = ["script:npc_talk:대화"]

    # === Presence Text (상황 묘사) ===
    PRESENCE_TEXT = {
        # activity 기반
        "activity:관리": "{name}가 서류를 검토하고 있다.",
        "activity:조회": "{name}가 모두에게 지시를 내리고 있다.",
        "activity:식사": "{name}가 우아하게 식사 중이다.",
        "activity:수면": "{name}가 단정한 자세로 잠들어 있다.",
        "activity:휴식": "{name}가 창밖을 바라보고 있다.",

        # 장소 기반
        "0:1": "{name}가 거실 중앙에 서서 상황을 파악하고 있다.",  # 거실
        "0:11": "{name}가 책상에서 서류를 정리하고 있다.",  # 엘라의 방

        # 기본값
        "default": "{name}가 위엄있게 서 있다."
    }

    # === 대화 데이터 ===
    DIALOGUES = {
        "default": {"pages": ["나는 엘라. 이 저택의 관리를 맡고 있다.", "네가 기억을 잃었다는 건 들었다.", "당분간 여기서 지내도 좋다. 단, 규칙은 지켜라."]},
        "휴식": {"pages": ["...무슨 일이지?", "급한 게 아니라면 나중에 이야기하도록."]},
        "식사": {"pages": ["(우아하게 식사 중이다)", "...식사 중이다. 볼일이 있으면 나중에."]},
        "수면": {"pages": ["(자고 있다)", "......"]},
        "관리": {"pages": ["(서류를 검토하고 있다)", "...지금 바쁘다. 급한 일인가?"]},
        "조회": {"pages": ["아침 조회 중이다.", "네 차례가 되면 말하겠다. 기다려라."]},
        "순찰": {"pages": ["(저택을 순찰 중이다)", "이상은 없는가?"]},
        "준비": {"pages": ["......", "...볼일이 있으면 조회 때 말하도록."]}
    }

    # === 장소 상수 ===
    MY_ROOM = (0, 11)
    DINING = (0, 3)
    LIVING = (0, 1)

    # === 시간대별 스케줄 ===
    SCHEDULE = [
        (5, 6, "준비", MY_ROOM),        # 5:30~6:30: 기상 (일찍 일어남)
        (7, 7, "식사", DINING),          # 7시~7:30: 아침식사 (짧게)
        (7, 8, "조회", LIVING),          # 7:30~8:30: 조회
        (9, 12, "관리", MY_ROOM),        # 9시~12시: 관리
        (12, 13, "식사", DINING),        # 12시~13시: 점심식사
        (14, 15, "순찰", LIVING),        # 14시~15시: 순찰
        (15, 18, "관리", MY_ROOM),       # 15시~18시: 관리
        (18, 19, "식사", DINING),        # 18:30~19:30: 저녁식사
        (20, 22, "휴식", MY_ROOM),       # 20시~22:30: 휴식
        (23, 5, "수면", MY_ROOM),        # 23시~다음날 5:30: 수면
    ]

    # === 이벤트 핸들러 ===
    def on_meet_player(self) -> dict:
        """플레이어와 처음 만났을 때"""
        if self._first_met:
            return None

        # 수면 중에는 이벤트 없음
        if self.get_activity() == "수면":
            return None

        self._first_met = True
        return {
            "type": "monologue",
            "pages": [
                "...깨어났군.",
                "나는 엘라. 이 저택을 관리하고 있다.",
                "네가 숲에서 쓰러져 있는 걸 발견한 건 이틀 전이다.",
                "기억을 잃었다고 들었다. 불쌍하군.",
                "당분간 여기서 지내도 좋다.",
                "단, 규칙은 지켜라. 모두의 안전이 달려 있으니까."
            ],
            "time_consumed": 5,
            "button_type": "ok"
        }
