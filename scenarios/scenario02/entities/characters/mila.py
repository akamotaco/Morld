# entities/characters/mila.py - 밀라 캐릭터 정의

from entities.characters.base import BaseCharacter


class Mila(BaseCharacter):
    """밀라 - 다정한 요리사"""

    # === 기본 정보 ===
    ID = 3
    NAME = "밀라"
    TYPE = "female"
    START_LOCATION = (0, 9)  # 밀라의 방

    # === 태그 (스탯) ===
    TAGS = {
        # 외모
        "외모:갈색머리": 1,
        "외모:중간머리": 1,
        "외모:갈색눈": 1,
        # 성격
        "성격:다정함": 1,
        "성격:걱정많음": 1,
        # 관계 (플레이어와)
        "애정": 0,
        "성욕": 0,
        "질투": 0,
        # 상태
        "피로": 0,
        "기분": 6,
    }

    # === 외관 묘사 ===
    APPEARANCE = {
        "default": "부드러운 갈색 머리의 다정한 여성. 따뜻한 갈색 눈이 편안함을 준다.",
        "기쁨": "온화하게 웃고 있다. 보는 사람도 기분이 좋아진다.",
        "슬픔": "걱정스러운 표정이다. 무언가 마음에 걸리는 것 같다.",
        "식사": "다른 사람들이 맛있게 먹는지 살피고 있다.",
        "수면": "평화롭게 잠들어 있다.",
        "요리": "앞치마를 두르고 열심히 요리하고 있다."
    }

    # === 행동 목록 ===
    ACTIONS = ["script:npc_talk:대화"]

    # === Presence Text (상황 묘사) ===
    PRESENCE_TEXT = {
        # activity 기반
        "activity:요리": "{name}가 분주하게 요리하고 있다.",
        "activity:식사": "{name}가 다른 사람들이 먹는 모습을 흐뭇하게 바라본다.",
        "activity:수면": "{name}가 포근하게 잠들어 있다.",
        "activity:휴식": "{name}가 따뜻한 차를 마시고 있다.",

        # 장소 기반
        "0:2": "{name}가 요리에 열중하고 있다.",  # 주방
        "0:3": "{name}가 식탁을 정리하고 있다.",  # 식당

        # 기본값
        "default": "{name}가 다정한 눈으로 주변을 살핀다."
    }

    # === 대화 데이터 ===
    DIALOGUES = {
        "default": {"pages": ["안녕하세요. 저는 밀라예요.", "여기서 요리를 맡고 있어요.", "혹시 배고프지 않으세요? 뭐라도 만들어 드릴까요?"]},
        "휴식": {"pages": ["잠시 쉬고 있어요.", "차 한 잔 하실래요?"]},
        "식사": {"pages": ["다들 맛있게 드시고 계시네요.", "더 필요하신 건 없으세요?"]},
        "수면": {"pages": ["(자고 있다)", "......"]},
        "요리": {"pages": ["(요리에 집중하고 있다)", "조금만 기다려 주세요. 곧 완성이에요!"]},
        "준비": {"pages": ["좋은 아침이에요!", "곧 아침 식사 준비할게요."]},
        "설거지": {"pages": ["(설거지를 하고 있다)", "식사는 맛있으셨어요?"]},
        "정리": {"pages": ["(주방을 정리하고 있다)", "오늘도 수고 많으셨어요."]}
    }

    # === 장소 상수 ===
    MY_ROOM = (0, 9)
    KITCHEN = (0, 2)
    DINING = (0, 3)
    LIVING = (0, 1)

    # === 시간대별 스케줄 ===
    SCHEDULE = [
        (5, 6, "준비", MY_ROOM),          # 5시~6시: 기상
        (6, 7, "요리", KITCHEN),           # 6시~7시: 아침 준비
        (7, 8, "식사", DINING),            # 7시~8시: 아침식사
        (8, 9, "설거지", KITCHEN),         # 8시~9시: 설거지
        (11, 12, "요리", KITCHEN),         # 11시~12시: 점심 준비
        (12, 13, "식사", DINING),          # 12시~13시: 점심식사
        (14, 16, "휴식", LIVING),          # 14시~16시: 휴식
        (17, 18, "요리", KITCHEN),         # 17시~18:30: 저녁 준비
        (18, 19, "식사", DINING),          # 18:30~19:30: 저녁식사
        (19, 21, "정리", KITCHEN),         # 19:30~21시: 정리
        (22, 5, "수면", MY_ROOM),          # 22시~다음날 5시: 수면
    ]

    # === 이벤트 핸들러 ===
    def on_meet_player(self) -> dict:
        """플레이어와 처음 만났을 때"""
        if self._first_met:
            return None

        # 수면 중에는 이벤트 없음
        if self.get_activity() == "수면":
            return None

        self._first_met = True
        return {
            "type": "monologue",
            "pages": [
                "어머, 깨어나셨군요!",
                "저는 밀라예요. 여기서 요리를 맡고 있어요.",
                "많이 힘드셨죠? 기억은... 좀 나세요?",
                "괜찮아요, 천천히 쉬세요. 필요한 게 있으면 말씀해 주세요."
            ],
            "time_consumed": 3,
            "button_type": "ok"
        }
