# 시나리오 02: 방탈출

## 개요

- **이름**: 방탈출
- **설명**: 시나리오 변경 기능 및 신규 기술 구현 테스트
- **버전**: 1.0.0

플레이어가 미스터리한 저택에 갇혀 10개의 방을 탐험하며 탈출하는 방탈출 게임입니다.

---

## 스토리 개요

1. **시작**: 알 수 없는 이유로 낯선 저택에 갇힘
2. **탐색**: 각 방을 돌아다니며 단서와 아이템 수집
3. **퍼즐**: 열쇠, 비밀번호, 스위치 등 다양한 기믹 해결
4. **탈출**: 정문을 열고 저택 탈출 성공

---

## 방 구조 (10개)

```
                    [9. 정문 홀]
                         |
    [7. 서재] ─── [8. 복도 2층] ─── [6. 침실]
                         |
                    [5. 계단]
                         |
    [3. 주방] ─── [4. 복도 1층] ─── [2. 거실]
                         |
                    [1. 창고]
                         |
                    [0. 지하실] ← 시작
```

### Region 0: 저택

| ID | 이름 | 설명 | 연결 |
|----|------|------|------|
| 0 | 지하실 | 시작 위치. 어둡고 습한 공간 | → 창고 (잠금) |
| 1 | 창고 | 오래된 물건들이 쌓여있음 | ↔ 지하실, 복도1층 |
| 2 | 거실 | 낡은 소파와 벽난로 | ↔ 복도1층 |
| 3 | 주방 | 먼지 쌓인 주방 | ↔ 복도1층 |
| 4 | 복도 1층 | 1층 중앙 복도 | ↔ 창고, 거실, 주방, 계단 |
| 5 | 계단 | 2층으로 올라가는 계단 | ↔ 복도1층, 복도2층 |
| 6 | 침실 | 침대와 화장대 | ↔ 복도2층 |
| 7 | 서재 | 책장과 책상 | ↔ 복도2층 (비밀번호 잠금) |
| 8 | 복도 2층 | 2층 중앙 복도 | ↔ 계단, 침실, 서재, 정문홀 |
| 9 | 정문 홀 | 탈출구. 정문이 있음 | ↔ 복도2층 (황금열쇠 필요) |

---

## 오브젝트 목록

| ID | 이름 | 위치 | 기능 | 숨겨진 아이템 |
|----|------|------|------|--------------|
| 100 | 낡은 상자 | 지하실 | 조사 | 녹슨 열쇠 |
| 101 | 배전함 | 지하실 | 스위치 조작 | - |
| 102 | 선반 | 창고 | 조사 | 쪽지1 (힌트) |
| 103 | 낡은 캐비닛 | 창고 | 잠금 (녹슨 열쇠) | 은열쇠 |
| 104 | 벽난로 | 거실 | 조사 | 숫자 힌트 (3) |
| 105 | 소파 쿠션 | 거실 | 조사 | 쪽지2 (힌트) |
| 106 | 냉장고 | 주방 | 조사 | 숫자 힌트 (7) |
| 107 | 찬장 | 주방 | 잠금 (은열쇠) | **황금열쇠 머리** |
| 108 | 침대 밑 | 침실 | 조사 | 일기장 (스토리) |
| 109 | 화장대 서랍 | 침실 | 잠금 (4자리 비밀번호: 3749) | 서재 비밀번호 메모 |
| 110 | 그림 액자 | 복도 2층 | 조사 | 숫자 힌트 (4, 9) |
| 111 | 금고 | 서재 | 잠금 (4자리 비밀번호: 1842) | **황금열쇠 몸통** |
| 112 | 책상 서랍 | 서재 | 조사 | 쪽지3 (최종 힌트) |
| 113 | 정문 | 정문 홀 | 탈출구 (황금열쇠) | - |
| 114 | 서재 문 | 복도 2층 | 잠금 (4자리 비밀번호: 2847) | - |
| 115 | 괘종시계 | 복도 1층 | 조사 (플레이버) | 힌트: "1842년 제작" |
| 116 | 우산꽂이 | 복도 1층 | 조사 (플레이버) | - |
| 117 | 부서진 계단 | 계단 | 조사 (플레이버) | - |
| 118 | 창문 | 계단 | 조사 (플레이버) | - |

---

## 아이템 목록

| ID | 이름 | 용도 | 획득처 |
|----|------|------|--------|
| 1 | 녹슨 열쇠 | 낡은 캐비닛 열기 | 지하실 낡은 상자 |
| 2 | 은열쇠 | 주방 찬장 열기 | 창고 캐비닛 |
| 3 | 황금열쇠 | 정문 열기 (탈출) | **조합으로 획득** |
| 4 | 쪽지1 | 힌트: "빛이 없으면 길도 없다" | 창고 선반 |
| 5 | 쪽지2 | 힌트: "불꽃 속에 숫자가 숨어있다" | 거실 소파 |
| 6 | 쪽지3 | 힌트: "연도를 기억하라 - 1842" | 서재 책상 |
| 7 | 일기장 | 스토리: 저택 주인의 비밀 | 침실 침대 밑 |
| 9 | 서재 메모 | 힌트: "서재 문 비밀번호: 2847" | 침실 화장대 |
| **10** | **황금열쇠 머리** | **황금열쇠 조합 재료** | **주방 찬장** |
| **11** | **황금열쇠 몸통** | **황금열쇠 조합 재료** | **서재 금고** |

---

## 퍼즐 흐름

### 1단계: 지하실 탈출
```
[지하실] 낡은 상자 조사 → 녹슨 열쇠 획득
[지하실] 배전함 스위치 ON → 지하실-창고 문 열림
→ 창고로 이동 가능
```

### 2단계: 1층 탐색
```
[창고] 낡은 캐비닛 (녹슨 열쇠) → 은열쇠 획득
[창고] 선반 조사 → 쪽지1 획득
[복도 1층] 괘종시계 조사 → "1842년 제작" 힌트 (플레이버)
[거실] 소파 쿠션 조사 → 쪽지2 획득
[거실] 벽난로 조사 → 숫자 3 발견
[주방] 찬장 (은열쇠) → 황금열쇠 머리 획득
[주방] 냉장고 조사 → 숫자 7 발견
→ 2층으로 이동
```

### 3단계: 2층 탐색 & 비밀번호 해독
```
[복도 2층] 그림 액자 조사 → 숫자 4, 9 발견
[침실] 침대 밑 조사 → 일기장 획득
[침실] 화장대 서랍 (비밀번호: 3749) → 서재 메모 획득
  * 힌트: 벽난로(3), 냉장고(7), 액자(4,9)
[복도 2층] 서재 문 (비밀번호: 2847) → 서재 입장
```

### 4단계: 서재 탐색 & 조합
```
[서재] 금고 (비밀번호: 1842) → 황금열쇠 몸통 획득
  * 힌트: 일기장/괘종시계 "저택이 지어진 해 1842"
[서재] 책상 서랍 조사 → 쪽지3 획득 (최종 확인용)
[인벤토리] 황금열쇠 머리 또는 몸통에서 "조합" → 황금열쇠 완성!
```

### 5단계: 탈출
```
[정문 홀] 정문 (황금열쇠) → 탈출 성공!
  * 황금열쇠 소모됨
```

---

## 구현된 기능

### 1. 스위치 기믹 (배전함) - 완료
- `morld.set_flag()` / `morld.get_flag()` API로 스위치 상태 관리
- Edge 조건에 flag 상태 체크 (`power: 1`)
- `script:toggle_switch` 액션으로 스위치 조작

### 2. 잠긴 오브젝트 (서랍, 캐비닛) - 완료
- Python 스크립트에서 `LOCK_INFO` 딕셔너리로 잠금 정보 관리
- `script:unlock_object` 액션으로 열쇠 확인 후 해제
- `morld.has_item()` API로 열쇠 보유 확인

### 3. 4자리 비밀번호 입력 - 완료
- BBCode 링크로 숫자 버튼 구현 `[url=script:input_digit:1][ 1 ][/url]`
- `morld.set_flag("password_input", value)`로 입력 상태 관리
- `type: "update"` 반환으로 모놀로그 내용 실시간 갱신
- 4자리 완성 시 `verify_password()` 함수에서 검증

### 4. 조사 액션 (아이템 발견) - 완료
- `script:examine_object` 액션
- `HIDDEN_ITEMS` 딕셔너리에서 오브젝트별 숨겨진 아이템 관리
- `morld.set_flag("examined_XXX", 1)`로 조사 완료 상태 저장
- `morld.give_item()` API로 아이템 지급

### 5. 게임 클리어 이벤트 - 완료
- `script:escape` 액션으로 정문 사용
- 황금열쇠 보유 확인 후 소모 (`morld.remove_item()`)
- 엔딩 모놀로그 + `button_type: "none_on_last"`로 게임 종료 (중간 페이지는 "계속" 버튼, 마지막만 버튼 없음)

### 6. 아이템 조합 시스템 - 완료 (신규)
- 황금열쇠를 머리(id:10) + 몸통(id:11) 두 파츠로 분리
- `script:combine_key:조합@inventory` 액션
- 두 파츠 보유 시 조합 → 황금열쇠(id:3) 생성
- 한쪽만 보유 시 "다른 파츠가 필요하다" 메시지

---

## 모놀로그

### 게임 시작 (on_event: "ready")
```
"......?"
"여기는... 어디지?"
"어둡고 축축한 공간이다. 지하실인 것 같다."
"기억이... 잘 나지 않는다."
"일단 여기서 나가야 한다."
```

### 게임 클리어 (escape 함수)
```
"마침내... 문이 열렸다!"
"차가운 바깥 공기가 느껴진다."
"자유다. 드디어 이 저택에서 벗어났다."
"[탈출 성공]"
"플레이해주셔서 감사합니다."
```

---

## 힌트 시스템

### 숫자 힌트 배치
- **3**: 거실 벽난로 - "불꽃 속에 '3'이라는 숫자가 새겨져 있다"
- **7**: 주방 냉장고 - "냉장고 문에 '7'이라는 자석이 붙어있다"
- **4, 9**: 복도 2층 액자 - "그림 뒤에 '4'와 '9'가 적혀있다"
- **화장대 비밀번호**: 3749 (발견 순서대로)

### 메모/쪽지 힌트
- **쪽지1**: "빛이 없으면 길도 없다" → 배전함 스위치 힌트
- **쪽지2**: "불꽃 속에 숫자가 숨어있다" → 벽난로 조사 힌트
- **일기장**: "1842년... 금고에 열쇠를 숨겼다" → 1842 힌트
- **서재 메모**: "서재 문 비밀번호: 2847"
- **쪽지3**: "연도를 기억하라 - 1842" → 금고 최종 확인
- **괘종시계**: "1842년 제작" → 금고 힌트 (플레이버)

---

## 테스트 체크리스트

### 기본 기능
- [x] 게임 시작 모놀로그 표시
- [x] 방 간 이동 정상 작동
- [x] 장소 묘사 표시

### 아이템 시스템
- [x] 오브젝트 조사 시 아이템 획득
- [x] 인벤토리에 아이템 표시
- [x] 아이템 사용 (열쇠 - 자동 사용)

### 스위치 기믹
- [x] 배전함 스위치 조작
- [x] 스위치 ON 시 지하실-창고 경로 활성화

### 잠금 해제
- [x] 녹슨 열쇠 → 캐비닛 열기
- [x] 은열쇠 → 찬장 열기
- [x] 황금열쇠 → 정문 열기

### 비밀번호 입력
- [x] 화장대 서랍 (3749)
- [x] 서재 문 (2847)
- [x] 금고 (1842)

### 조합 시스템
- [ ] 황금열쇠 머리 획득 (찬장)
- [ ] 황금열쇠 몸통 획득 (금고)
- [ ] 두 파츠 조합 → 황금열쇠 완성
- [ ] 한쪽만 있을 때 조합 시도 → 안내 메시지

### 게임 클리어
- [x] 정문 통과 시 엔딩 모놀로그
- [x] 황금열쇠 소모
- [x] 클리어 메시지 표시 (버튼 없음)

---

## 예상 플레이 시간

- 최단 클리어: 5-10분 (정답 숙지 시)
- 일반 플레이: 20-30분

---

## 변경 이력

| 날짜 | 버전 | 내용 |
|------|------|------|
| 2025-01-03 | 1.0.0 | 초기 설계 |
| 2026-01-03 | 1.1.0 | 황금열쇠 파츠화 (머리+몸통 조합), 새 오브젝트 추가 (괘종시계, 우산꽂이, 부서진 계단, 창문), 오브젝트 묘사 풍부화, 아이템 use 액션 제거 |
